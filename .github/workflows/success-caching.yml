name: Success Caching

on:
  workflow_dispatch: 
    inputs:
      status:
        default: "fail"

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
    steps:
      - name: Get current date
        id: date
        run: echo "::set-output name=date::$(date +'%Y-%m-%dT%H:%M:%S')"

      - name: Log date
        run: echo "${{ steps.date.outputs.date }}"

      - name: Set default run status
        run: echo "::set-output name=last_run_status::default" > last_run_status

      - name: Restore last 
        id: last_run
        uses: actions/cache@v2
        with:
          path: |
            last_run_status
          key: ${{ github.run_id }}
          restore-keys:
            ${{ github.run_id }}

      - name: Set status
        run: |
          echo "Status: $STATUS"
          echo "$STATUS" > last_run_status
          if [ "STATUS" == "fail"]; then 
            exit 1
          fi
        env:
          STATUS: ${{ github.event.inputs.status }}
